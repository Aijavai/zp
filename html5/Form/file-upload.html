<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Êñá‰ª∂‰∏ä‰º†Á§∫‰æã - Â∏¶È¢ÑËßàÂíåËøõÂ∫¶Êù°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }

    .upload-area {
      border: 3px dashed #ddd;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .upload-area.dragover {
      border-color: #667eea;
      background: #e8ebff;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 48px;
      color: #667eea;
      margin-bottom: 10px;
    }

    .upload-text {
      color: #666;
      margin-bottom: 10px;
    }

    .upload-hint {
      color: #999;
      font-size: 12px;
    }

    #fileInput {
      display: none;
    }

    .file-list {
      margin-top: 20px;
    }

    .file-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      position: relative;
    }

    .file-info {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .file-preview {
      width: 60px;
      height: 60px;
      border-radius: 5px;
      object-fit: cover;
      margin-right: 15px;
      background: #e9ecef;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      font-size: 12px;
    }

    .file-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 5px;
    }

    .file-details {
      flex: 1;
    }

    .file-name {
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
      word-break: break-all;
    }

    .file-size {
      color: #666;
      font-size: 12px;
    }

    .file-remove {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      transition: all 0.3s;
    }

    .file-remove:hover {
      background: #c0392b;
      transform: rotate(90deg);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      transition: width 0.3s;
      border-radius: 3px;
    }

    .progress-text {
      text-align: center;
      color: #666;
      font-size: 12px;
      margin-top: 5px;
    }

    .upload-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      margin-top: 20px;
    }

    .upload-btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error {
      color: #e74c3c;
      font-size: 12px;
      margin-top: 5px;
    }

    .success {
      color: #27ae60;
      text-align: center;
      padding: 15px;
      background: #d4edda;
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÅ Êñá‰ª∂‰∏ä‰º†</h1>
    
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">‚òÅÔ∏è</div>
      <div class="upload-text">ÁÇπÂáªÈÄâÊã©Êñá‰ª∂ÊàñÊãñÊãΩÊñá‰ª∂Âà∞ËøôÈáå</div>
      <div class="upload-hint">ÊîØÊåÅ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºèÔºåÊúÄÂ§ß 5MB</div>
      <input type="file" id="fileInput" multiple accept="image/*">
    </div>

    <div class="file-list" id="fileList"></div>

    <button class="upload-btn" id="uploadBtn" disabled>‰∏ä‰º†Êñá‰ª∂</button>

    <div id="successMessage" style="display: none;"></div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const uploadBtn = document.getElementById('uploadBtn');
    const successMessage = document.getElementById('successMessage');

    let selectedFiles = [];

    // ÁÇπÂáª‰∏ä‰º†Âå∫Âüü
    uploadArea.addEventListener('click', () => {
      fileInput.click();
    });

    // Êñá‰ª∂ÈÄâÊã©
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    // ÊãñÊãΩ‰∫ã‰ª∂
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.remove('dragover');
      });
    });

    uploadArea.addEventListener('drop', (e) => {
      const files = e.dataTransfer.files;
      handleFiles(files);
    });

    // Â§ÑÁêÜÊñá‰ª∂
    function handleFiles(files) {
      const fileArray = Array.from(files);
      
      fileArray.forEach(file => {
        // È™åËØÅÊñá‰ª∂
        if (!validateFile(file)) return;
        
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
        if (selectedFiles.find(f => f.name === file.name && f.size === file.size)) {
          alert(`Êñá‰ª∂ ${file.name} Â∑≤Ê∑ªÂä†`);
          return;
        }
        
        selectedFiles.push(file);
        displayFile(file);
      });

      updateUploadButton();
    }

    // È™åËØÅÊñá‰ª∂
    function validateFile(file) {
      const maxSize = 5 * 1024 * 1024; // 5MB
      const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];

      if (!allowedTypes.includes(file.type)) {
        alert(`Êñá‰ª∂ ${file.name} Ê†ºÂºè‰∏çÊîØÊåÅÔºÅ\nÂè™ÊîØÊåÅ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºè`);
        return false;
      }

      if (file.size > maxSize) {
        alert(`Êñá‰ª∂ ${file.name} Â§™Â§ßÔºÅ\nÊúÄÂ§ßÊîØÊåÅ 5MB`);
        return false;
      }

      return true;
    }

    // ÊòæÁ§∫Êñá‰ª∂
    function displayFile(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      fileItem.dataset.fileName = file.name;

      const fileInfo = document.createElement('div');
      fileInfo.className = 'file-info';

      // È¢ÑËßàÂõæÁâá
      const preview = document.createElement('div');
      preview.className = 'file-preview';
      
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      } else {
        preview.textContent = 'üìÑ';
      }

      // Êñá‰ª∂ËØ¶ÊÉÖ
      const details = document.createElement('div');
      details.className = 'file-details';
      
      const fileName = document.createElement('div');
      fileName.className = 'file-name';
      fileName.textContent = file.name;
      
      const fileSize = document.createElement('div');
      fileSize.className = 'file-size';
      fileSize.textContent = formatFileSize(file.size);

      details.appendChild(fileName);
      details.appendChild(fileSize);

      // Âà†Èô§ÊåâÈíÆ
      const removeBtn = document.createElement('button');
      removeBtn.className = 'file-remove';
      removeBtn.innerHTML = '√ó';
      removeBtn.onclick = () => removeFile(file.name, fileItem);

      fileInfo.appendChild(preview);
      fileInfo.appendChild(details);

      fileItem.appendChild(fileInfo);
      fileItem.appendChild(removeBtn);

      // ËøõÂ∫¶Êù°ÔºàÂàùÂßãÈöêËóèÔºâ
      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.style.display = 'none';
      
      const progressFill = document.createElement('div');
      progressFill.className = 'progress-fill';
      progressFill.style.width = '0%';
      
      progressBar.appendChild(progressFill);
      fileItem.appendChild(progressBar);

      const progressText = document.createElement('div');
      progressText.className = 'progress-text';
      progressText.style.display = 'none';
      fileItem.appendChild(progressText);

      fileList.appendChild(fileItem);
    }

    // Âà†Èô§Êñá‰ª∂
    function removeFile(fileName, fileItem) {
      selectedFiles = selectedFiles.filter(f => f.name !== fileName);
      fileItem.remove();
      updateUploadButton();
    }

    // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Êõ¥Êñ∞‰∏ä‰º†ÊåâÈíÆÁä∂ÊÄÅ
    function updateUploadButton() {
      uploadBtn.disabled = selectedFiles.length === 0;
      uploadBtn.textContent = selectedFiles.length > 0 
        ? `‰∏ä‰º† ${selectedFiles.length} ‰∏™Êñá‰ª∂` 
        : '‰∏ä‰º†Êñá‰ª∂';
    }

    // ‰∏ä‰º†Êñá‰ª∂
    uploadBtn.addEventListener('click', async () => {
      uploadBtn.disabled = true;
      uploadBtn.textContent = '‰∏ä‰º†‰∏≠...';
      successMessage.style.display = 'none';

      for (let i = 0; i < selectedFiles.length; i++) {
        const file = selectedFiles[i];
        await uploadFile(file);
      }

      // ‰∏ä‰º†ÂÆåÊàê
      uploadBtn.textContent = '‰∏ä‰º†ÂÆåÊàê';
      successMessage.className = 'success';
      successMessage.textContent = `‚úì ÊàêÂäü‰∏ä‰º† ${selectedFiles.length} ‰∏™Êñá‰ª∂`;
      successMessage.style.display = 'block';

      // Ê∏ÖÁ©∫Êñá‰ª∂ÂàóË°®
      setTimeout(() => {
        selectedFiles = [];
        fileList.innerHTML = '';
        updateUploadButton();
        successMessage.style.display = 'none';
      }, 2000);
    });

    // ‰∏ä‰º†Âçï‰∏™Êñá‰ª∂ÔºàÊ®°ÊãüÔºâ
    async function uploadFile(file) {
      const fileItem = document.querySelector(`[data-file-name="${file.name}"]`);
      const progressBar = fileItem.querySelector('.progress-bar');
      const progressFill = fileItem.querySelector('.progress-fill');
      const progressText = fileItem.querySelector('.progress-text');

      progressBar.style.display = 'block';
      progressText.style.display = 'block';

      // Ê®°Êãü‰∏ä‰º†ËøõÂ∫¶
      for (let progress = 0; progress <= 100; progress += 10) {
        await new Promise(resolve => setTimeout(resolve, 100));
        progressFill.style.width = progress + '%';
        progressText.textContent = `‰∏ä‰º†‰∏≠: ${progress}%`;
      }

      progressText.textContent = '‚úì ‰∏ä‰º†ÂÆåÊàê';
      progressText.style.color = '#27ae60';

      // ÂÆûÈôÖ‰∏ä‰º†‰ª£Á†ÅÔºà‰ΩøÁî® FormData Âíå fetchÔºâ
      /*
      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData,
          // ÁõëÂê¨‰∏ä‰º†ËøõÂ∫¶ÈúÄË¶Å‰ΩøÁî® XMLHttpRequest
        });

        if (response.ok) {
          const result = await response.json();
          console.log('‰∏ä‰º†ÊàêÂäü:', result);
        } else {
          throw new Error('‰∏ä‰º†Â§±Ë¥•');
        }
      } catch (error) {
        console.error('‰∏ä‰º†ÈîôËØØ:', error);
        progressText.textContent = '‚úó ‰∏ä‰º†Â§±Ë¥•';
        progressText.style.color = '#e74c3c';
      }
      */
    }

    // ‰ΩøÁî® XMLHttpRequest ÂÆûÁé∞ÁúüÂÆûÁöÑËøõÂ∫¶ÁõëÂê¨
    function uploadFileWithProgress(file) {
      return new Promise((resolve, reject) => {
        const formData = new FormData();
        formData.append('file', file);

        const xhr = new XMLHttpRequest();

        // ‰∏ä‰º†ËøõÂ∫¶
        xhr.upload.addEventListener('progress', (e) => {
          if (e.lengthComputable) {
            const percent = Math.round((e.loaded / e.total) * 100);
            const fileItem = document.querySelector(`[data-file-name="${file.name}"]`);
            const progressFill = fileItem.querySelector('.progress-fill');
            const progressText = fileItem.querySelector('.progress-text');
            
            progressFill.style.width = percent + '%';
            progressText.textContent = `‰∏ä‰º†‰∏≠: ${percent}%`;
          }
        });

        // ‰∏ä‰º†ÂÆåÊàê
        xhr.addEventListener('load', () => {
          if (xhr.status === 200) {
            resolve(JSON.parse(xhr.responseText));
          } else {
            reject(new Error('‰∏ä‰º†Â§±Ë¥•'));
          }
        });

        // ‰∏ä‰º†ÈîôËØØ
        xhr.addEventListener('error', () => {
          reject(new Error('ÁΩëÁªúÈîôËØØ'));
        });

        xhr.open('POST', '/upload');
        xhr.send(formData);
      });
    }
  </script>
</body>
</html>

