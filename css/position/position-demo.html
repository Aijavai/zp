<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS定位深入理解与测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        
        .demo-box {
            margin: 20px 0;
            padding: 20px;
            background-color: #fff;
            border: 1px dashed #ccc;
            border-radius: 4px;
            position: relative;
        }
        
        .box {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border-radius: 4px;
            margin: 10px;
        }
        
        .box-1 {
            background-color: #ff6b6b;
        }
        
        .box-2 {
            background-color: #4ecdc4;
        }
        
        .box-3 {
            background-color: #45b7d1;
        }
        
        .box-4 {
            background-color: #96ceb4;
        }
        
        .box-5 {
            background-color: #ffeaa7;
            color: #333;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .description {
            margin-bottom: 15px;
            color: #555;
        }
        
        /* 测试容器样式 */
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #3498db;
            background-color: #f0f7ff;
            min-height: 300px;
            position: relative;
        }
        
        /* 相对定位测试 */
        .relative-test .box-2 {
            position: relative;
            top: 20px;
            left: 30px;
        }
        
        /* 绝对定位测试 */
        .absolute-test {
            position: relative; /* 作为绝对定位元素的参考 */
        }
        
        .absolute-test .box-3 {
            position: absolute;
            top: 50px;
            left: 150px;
        }
        
        /* 固定定位测试 */
        .fixed-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
        }
        
        /* 粘性定位测试 */
        .sticky-test {
            height: 600px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
        }
        
        .sticky-box {
            position: sticky;
            top: 10px;
            background-color: #9b59b6;
            color: white;
            padding: 10px;
            margin: 10px 0;
        }
        
        /* 堆叠上下文测试 */
        .stacking-context {
            margin: 20px 0;
        }
        
        .parent-context {
            position: relative;
            z-index: 1;
            background-color: rgba(255, 0, 0, 0.2);
            padding: 20px;
            margin: 10px 0;
        }
        
        .child-context {
            position: relative;
            z-index: 100;
            background-color: rgba(0, 0, 255, 0.2);
            padding: 10px;
            margin: 10px 0;
        }
        
        .outside-element {
            position: relative;
            z-index: 5;
            background-color: rgba(0, 255, 0, 0.2);
            padding: 10px;
            margin: -20px 0 10px 50px;
        }
        
        /* 包含块测试 */
        .containing-block {
            position: relative;
            width: 500px;
            height: 300px;
            border: 2px solid #e67e22;
            background-color: #fff3cd;
        }
        
        .containing-block .absolute-child {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 50%;
            height: 50%;
            background-color: rgba(230, 126, 34, 0.3);
        }
        
        /* BFC测试 */
        .bfc-test {
            margin: 20px 0;
        }
        
        .bfc-element {
            background-color: #dff0d8;
            padding: 20px;
            margin-bottom: 10px;
        }
        
        .bfc-trigger {
            position: absolute; /* 创建BFC */
            background-color: #f2dede;
            padding: 20px;
            margin-top: -10px;
        }
        
        /* 性能测试 - 对比top/left和transform */
        .performance-test {
            height: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .moving-box-top {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: #ff6348;
            top: 50px;
            animation: moveWithTop 5s infinite alternate;
        }
        
        .moving-box-transform {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: #2ecc71;
            top: 150px;
            animation: moveWithTransform 5s infinite alternate;
        }
        
        @keyframes moveWithTop {
            from { left: 0; }
            to { left: 80%; }
        }
        
        @keyframes moveWithTransform {
            from { transform: translateX(0); }
            to { transform: translateX(80%); }
        }
        
        /* 导航栏示例 */
        .navbar-container {
            height: 1000px;
            padding-top: 60px;
        }
        
        .navbar-sticky {
            position: sticky;
            top: 0;
            background-color: #34495e;
            color: white;
            padding: 15px;
            z-index: 100;
        }
        
        .navbar-fixed {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSS定位深入理解与测试</h1>
        
        <!-- 固定定位示例 -->
        <div class="fixed-box">固定定位元素</div>
        
        <!-- 静态定位 -->
        <div class="section">
            <h2>1. 静态定位 (Static)</h2>
            <div class="description">
                静态定位是元素的默认定位方式，元素按照正常文档流排列，不受top、right、bottom、left属性影响。
            </div>
            <div class="code-block">
                .static-element {<br>
                &nbsp;&nbsp;position: static; /* 默认值 */<br>
                &nbsp;&nbsp;top: 100px; /* 无效 */<br>
                }
            </div>
            <div class="demo-box">
                <div class="box box-1">静态元素1</div>
                <div class="box box-2">静态元素2</div>
                <div class="box box-3">静态元素3</div>
            </div>
        </div>
        
        <!-- 相对定位 -->
        <div class="section">
            <h2>2. 相对定位 (Relative)</h2>
            <div class="description">
                相对定位相对于元素自身的正常位置进行偏移，不脱离文档流，仍占据原位置空间。
                可以作为绝对定位元素的参考容器。
            </div>
            <div class="code-block">
                .relative-element {<br>
                &nbsp;&nbsp;position: relative;<br>
                &nbsp;&nbsp;top: 20px; /* 相对于自身顶部偏移20px */<br>
                &nbsp;&nbsp;left: 30px; /* 相对于自身左侧偏移30px */<br>
                }
            </div>
            <div class="demo-box relative-test">
                <div class="box box-1">静态元素</div>
                <div class="box box-2">相对定位元素<br>(top: 20px, left: 30px)</div>
                <div class="box box-3">静态元素</div>
            </div>
            <div class="description">
                <strong>注意：</strong>相对定位元素仍占据原位置空间，其他元素不会填补其位置。
            </div>
        </div>
        
        <!-- 绝对定位 -->
        <div class="section">
            <h2>3. 绝对定位 (Absolute)</h2>
            <div class="description">
                绝对定位元素脱离文档流，相对于最近的非static定位祖先元素定位。如果没有这样的祖先，
                则相对于初始包含块（通常是视口）定位。
            </div>
            <div class="code-block">
                .parent {<br>
                &nbsp;&nbsp;position: relative; /* 作为绝对定位的参考 */<br>
                }<br><br>
                .absolute-element {<br>
                &nbsp;&nbsp;position: absolute;<br>
                &nbsp;&nbsp;top: 50px;<br>
                &nbsp;&nbsp;left: 150px;<br>
                }
            </div>
            <div class="demo-box absolute-test">
                <div class="box box-1">静态元素</div>
                <div class="box box-2">静态元素</div>
                <div class="box box-3">绝对定位元素<br>(top: 50px, left: 150px)</div>
            </div>
            <div class="description">
                <strong>注意：</strong>绝对定位元素不占据空间，宽度会收缩为内容宽度（除非设置了width）。
            </div>
        </div>
        
        <!-- 固定定位 -->
        <div class="section">
            <h2>4. 固定定位 (Fixed)</h2>
            <div class="description">
                固定定位元素相对于浏览器视口定位，不随页面滚动而移动，完全脱离文档流。
                右上角的红色方块就是一个固定定位元素。
            </div>
            <div class="code-block">
                .fixed-element {<br>
                &nbsp;&nbsp;position: fixed;<br>
                &nbsp;&nbsp;top: 20px;<br>
                &nbsp;&nbsp;right: 20px;<br>
                &nbsp;&nbsp;z-index: 1000; /* 确保在顶层 */<br>
                }
            </div>
            <div class="description">
                <strong>transform影响：</strong>如果父元素有transform属性且不为none，
                fixed定位元素会相对于该父元素定位，而不是视口。
            </div>
        </div>
        
        <!-- 粘性定位 -->
        <div class="section">
            <h2>5. 粘性定位 (Sticky)</h2>
            <div class="description">
                粘性定位结合了relative和fixed的特性，在滚动到特定位置前表现为relative，之后表现为fixed。
                请滚动下方区域查看效果。
            </div>
            <div class="code-block">
                .sticky-element {<br>
                &nbsp;&nbsp;position: sticky;<br>
                &nbsp;&nbsp;top: 10px; /* 粘性阈值 */<br>
                }
            </div>
            <div class="sticky-test">
                <p>滚动此区域查看粘性定位效果...</p>
                <div style="height: 200px;">向下滚动...</div>
                <div class="sticky-box">我是粘性定位元素 (top: 10px)</div>
                <div style="height: 400px;">继续向下滚动...</div>
                <div class="sticky-box">另一个粘性定位元素 (top: 10px)</div>
                <div style="height: 400px;">继续向下滚动...</div>
            </div>
            <div class="description">
                <strong>注意：</strong>粘性定位受父元素滚动区域限制，父元素的overflow属性可能会影响粘性效果。
            </div>
        </div>
        
        <!-- 堆叠上下文测试 -->
        <div class="section">
            <h2>6. 堆叠上下文 (Stacking Context)</h2>
            <div class="description">
                堆叠上下文是决定元素在z轴方向排列顺序的三维概念。以下示例展示了嵌套堆叠上下文的层级关系。
            </div>
            <div class="code-block">
                .parent-context {<br>
                &nbsp;&nbsp;position: relative;<br>
                &nbsp;&nbsp;z-index: 1; /* 创建堆叠上下文 */<br>
                }<br><br>
                .child-context {<br>
                &nbsp;&nbsp;position: relative;<br>
                &nbsp;&nbsp;z-index: 100; /* 只在父级堆叠上下文中有效 */<br>
                }<br><br>
                .outside-element {<br>
                &nbsp;&nbsp;position: relative;<br>
                &nbsp;&nbsp;z-index: 5; /* 与.parent-context在同一层级 */<br>
                }
            </div>
            <div class="stacking-context">
                <div class="parent-context">
                    父级堆叠上下文 (z-index: 1)
                    <div class="child-context">
                        子级堆叠上下文 (z-index: 100) - 注意：尽管z-index值很大，但仍在父级上下文中
                    </div>
                </div>
                <div class="outside-element">
                    外部元素 (z-index: 5) - 这个元素会覆盖上面的子元素
                </div>
            </div>
            <div class="description">
                <strong>关键点：</strong>每个堆叠上下文是一个独立的层叠环境，子元素的z-index只在其父级上下文中有意义。
            </div>
        </div>
        
        <!-- 包含块测试 -->
        <div class="section">
            <h2>7. 包含块 (Containing Block)</h2>
            <div class="description">
                包含块是决定元素定位和大小的参考框。对于绝对定位元素，包含块是最近的非static定位祖先元素。
            </div>
            <div class="code-block">
                .containing-block {<br>
                &nbsp;&nbsp;position: relative;<br>
                &nbsp;&nbsp;width: 500px;<br>
                &nbsp;&nbsp;height: 300px;<br>
                }<br><br>
                .absolute-child {
                &nbsp;&nbsp;position: absolute;<br>
                &nbsp;&nbsp;right: 0;<br>
                &nbsp;&nbsp;bottom: 0;<br>
                &nbsp;&nbsp;width: 50%; /* 相对于包含块的宽度 */<br>
                &nbsp;&nbsp;height: 50%; /* 相对于包含块的高度 */<br>
                }
            </div>
            <div class="containing-block">
                相对定位的包含块
                <div class="absolute-child">
                    绝对定位的子元素<br>
                    (right: 0, bottom: 0, width: 50%, height: 50%)
                </div>
            </div>
        </div>
        
        <!-- BFC测试 -->
        <div class="section">
            <h2>8. 定位与BFC (块级格式化上下文)</h2>
            <div class="description">
                定位元素（除static外）会创建BFC。BFC可以防止margin重叠，隔离内部元素与外部元素的影响。
            </div>
            <div class="bfc-test">
                <div class="bfc-element">
                    这个元素有默认的margin-bottom: 10px
                </div>
                <div class="bfc-trigger">
                    这个元素使用绝对定位创建了BFC，它的margin-top: -10px不会与上面元素的margin-bottom重叠
                </div>
            </div>
        </div>
        
        <!-- 性能测试 -->
        <div class="section">
            <h2>9. 定位性能优化</h2>
            <div class="description">
                使用transform进行位置变化比使用top/left有更好的性能，因为transform可以利用GPU加速，不会触发重排。
                红色方块使用top/left移动，绿色方块使用transform移动。
            </div>
            <div class="performance-test">
                <div class="moving-box-top">top/left</div>
                <div class="moving-box-transform">transform</div>
            </div>
            <div class="code-block">
                /* 性能较差 - 触发重排 */<br>
                @keyframes moveWithTop {<br>
                &nbsp;&nbsp;from { left: 0; }<br>
                &nbsp;&nbsp;to { left: 80%; }<br>
                }<br><br>
                /* 性能更好 - 利用GPU加速 */<br>
                @keyframes moveWithTransform {<br>
                &nbsp;&nbsp;from { transform: translateX(0); }<br>
                &nbsp;&nbsp;to { transform: translateX(80%); }<br>
                }
            </div>
        </div>
        
        <!-- 实战应用 -->
        <div class="section">
            <h2>10. 实战应用：粘性导航栏</h2>
            <div class="description">
                结合sticky定位和fixed定位实现现代网页常见的导航效果。
            </div>
            <div class="navbar-container">
                <div class="navbar-sticky">
                    这是一个粘性导航栏 - 滚动页面时会固定在顶部
                </div>
                <p>滚动此区域查看导航栏效果...</p>
                <div style="height: 300px;">页面内容区域...</div>
                <p>继续滚动...</p>
                <div style="height: 300px;">更多页面内容...</div>
                <p>再往下滚动...</p>
                <div style="height: 300px;">更多内容...</div>
            </div>
            <a href="#" class="navbar-fixed">返回顶部</a>
        </div>
        
        <!-- 总结 -->
        <div class="section">
            <h2>11. 深入理解总结</h2>
            <div class="description">
                <ul>
                    <li><strong>定位方式选择：</strong>根据元素是否需要脱离文档流、定位参考系和滚动行为选择合适的定位方式</li>
                    <li><strong>堆叠上下文：</strong>理解z-index只在同一堆叠上下文中有效，避免z-index陷阱</li>
                    <li><strong>性能优化：</strong>动画效果优先使用transform，减少定位元素数量</li>
                    <li><strong>浏览器兼容性：</strong>sticky定位在IE中不支持，需要考虑降级方案</li>
                    <li><strong>最佳实践：</strong>合理使用relative作为absolute的参考容器，避免过度使用fixed定位</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // 简单的交互增强
        document.querySelectorAll('.section').forEach(section => {
            section.addEventListener('mouseenter', () => {
                section.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
            });
            section.addEventListener('mouseleave', () => {
                section.style.boxShadow = 'none';
            });
        });
        
        // 返回顶部按钮
        document.querySelector('.navbar-fixed').addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
</body>
</html>